<!DOCTYPE html>
<html>
    <head>
<meta charset="utf-8">
<meta name="viewport" 
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

<title>Помидорковый таймер &ndash; volter9.github.io</title>

<link href="/assets/css/likely.css"
      rel="stylesheet"
      type="text/css">
<link href="/assets/css/styles.css"
      rel="stylesheet"
      type="text/css">
<link href="/assets/css/theme.css"
      rel="stylesheet"
      type="text/css">
<link rel="alternate" type="application/rss+xml"
      href="/feed.xml" title="RSS Feed"> 
    </head>

    <body>
        <div class="wrapper">
 
<div class="epic-header full"
     style="background-color: #ED4455; padding-bottom: 80px;">
    <nav class="navigation navigation-white">
    <ul class="clearfix links">
     
        <li class="left">
            <a class="current" 
               href="/"
               target="_self">
                Главная 
            </a>
        </li>
     
        <li class="left">
            <a class="" 
               href="/blog"
               target="_self">
                Блог 
            </a>
        </li>
     
        <li class="left">
            <a class="" 
               href="/projects"
               target="_self">
                Проекты 
            </a>
        </li>
     
        <li class="left">
            <a class="" 
               href="https://github.com/volter9"
               target="_blank">
                GitHub 
            </a>
        </li>
     
        <li class="left">
            <a class="" 
               href="https://twitter.com/volter_9"
               target="_blank">
                Twitter 
            </a>
        </li>
     
    </ul>
</nav>    
    <div class="fluid">
        <h1 class="epic-header-title">
            Помидорковый таймер 
        </h1>
    </div>
    
    <img src="/assets/uploads/pomidorko-scale.png" 
         alt="scale" 
         class="adaptive"
         style="margin-top: 40px">
</div>

<article class="content full full-padding post">
<p><a href="http://pomidorko.ru/" target="_target">Помидорковый таймер</a> &mdash;
это инструмент для управлением времени с помощью техники Помидоро. Суть данной
техники это распределенние времени таким образом чтобы не нагружаться много,
давая себе и мозгу небольшой перерыв. Также доступна
<a href="http://pomidorko.com/" target="_target">Английская версия</a>
помидоркового таймера.</p>
<p>Инструкция по эксплутации таймера:</p>
<ol>
<li>Выберите задачу и работайте над ней 25 минут, ни на что не отвлекаясь.</li>
<li>Сделайте небольшой перерыв, заварите чаю, можно скушать банан.</li>
<li>Каждый четвертый перерыв отдыхайте дольше, мозгу нужно восстановиться.</li>
</ol>
<p>Моя роль в этом проекте была разработка самого приложения (верстка, JS, PHP).<br />
<a href="http://omelekhin.ru" target="_target">Паша Омелёхин</a>
занимался дизайном приложения а также правил иногда CSS.</p>
<h2>Техническая сторона проекта</h2>
<p>В данном проекте я использовал данные инструменты:</p>
<ul>
<li>GNU Make &mdash; автоматизация деплоя и сборки</li>
<li>browserify и uglify-js &mdash; сборка модульного front end JS кода</li>
<li>PHP &mdash; компиляция локализированного HTML</li>
<li>ncftp &mdash; FTP деплой</li>
<li>git &mdash; ну как а же без git?</li>
</ul>
<p>А теперь, полный рецепт этого блюда.</p>
<h3>Front end</h3>
<p>Весь функционал помидоркового таймера заключается в JS коде который собран в один
файл с помощью browserify и сжат с помощью uglify-js (а точнее его обертки minify).</p>
<p>Сам код написан на моем велосипеде который является упрощенной версией Backbone.js
фреймворка.</p>
<p>Сборка JS файла &mdash; это первая фаза сборки таймера.</p>
<h3>PHP</h3>
<p>Чтобы не заморачиватся с HTML, я написал небольшой PHP скрипт который собирает отдает
в шаблоны локализированные строки и выводит их в зависимости от языка.
Пока что у нас есть только две версии: Русская и Английская.</p>
<p>Там ничего сложного нету, голый PHP, HTML шаблоны и локализированные строки в JSON.
А потом все это компилируется в HTML. </p>
<p>Сборка HTML шаблонов &mdash; это вторая фаза сборки таймера. </p>
<h3>ncftp</h3>
<p>После сборки JS файла и HTML шаблонов следует третья фаза &mdash; деплой. В корне
проекта лежит простой bash скрипт для деплоя помидоркового таймера через FTP:</p>
<div class="spoiler spoiler-big"><pre class="language-sh"><code>#!/bin/sh

# FTP deploy script
source ./ftp.sh

DOMAIN="$1"
LANG="$2"
FILES=$(git diff --name-only HEAD~1 HEAD)

if [ "$3" == "true" ]
then
    FILES=$(git ls-files)
fi

FILES=$(echo "$FILES" | grep ^assets | awk '{print "put -z ./" $0 " ./" $0}')

ncftp &lt;&lt;EOF
open -u '$USER' -p '$PASS' '$HOST'
cd /www/pomidorko.$DOMAIN 
mkdir assets
mkdir assets/js
mkdir assets/css
mkdir assets/img
mkdir assets/sounds
put -zf ./build/$LANG.html index.php
$FILES
EOF</code></pre></div> 
<p>Данный скрипт подключается к FTP и загружает нужные файлы.
Нужные файлы определяются с помощью git и третьего аргумента в shell скрипт.
Если третий аргумент не существует или же не равен строке &quot;true&quot; то берется
разница между двумя последними коммитами, иначе загружаются все файлы через
FTP.</p>
<p>Файл <code>ftp.sh</code> содержит в себе переменные для подключения к FTP.</p>
<p>А сам деплой запускается одной командой</p>
<pre><code class="language-sh"># Частичный деплой
make deploy

# Полный деплой
make deploy FULL_DEPLOY=true</code></pre> 
    
    <div class="likely">
    <div class="vkontakte">Поделиться</div>
    <div class="twitter" data-via="volter_9">Твитнуть</div>
    <div class="facebook">Поделиться</div>
    <div class="gplus">Плюсануть</div>
</div></article>
 

<footer class="fluid" id="footer">
    <p>&copy; 2015+</p>
</footer>

<script src="/assets/js/hljs.js" 
        type="text/javascript"></script>
<script src="/assets/js/likely.js"
        type="text/javascript"></script>
<script src="/assets/js/spoiler.js"
        type="text/javascript"></script>
<script type="text/javascript">
    hljs.initHighlightingOnLoad();
</script> 
 
<!-- Yandex.Metrika counter -->
<script type="text/javascript"> (function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter32699335 = new Ya.Metrika({ id:32699335, clickmap:true, trackLinks:true, accurateTrackBounce:true }); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = "https://mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script><noscript><div><img src="https://mc.yandex.ru/watch/32699335" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
  
        </div>
    </body>
</html>